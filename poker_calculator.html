<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í¬ì»¤ ìŠ¹ë¥  ê³„ì‚°ê¸°</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
    }
    .input-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #34495e;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    input[type="text"]:focus {
      border-color: #3498db;
      outline: none;
    }
    button {
      background-color: #3498db;
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    button:hover {
      background-color: #2980b9;
    }
    .result {
      margin-top: 30px;
      padding: 20px;
      background-color: #ecf0f1;
      border-radius: 5px;
      border-left: 4px solid #3498db;
    }
    .error {
      color: #e74c3c;
      font-weight: bold;
    }
    .success {
      color: #27ae60;
      font-weight: bold;
    }
    .info {
      color: #7f8c8d;
      font-size: 14px;
      margin-top: 10px;
    }
    .player-inputs {
      border: 2px solid #ecf0f1;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .add-player-btn {
      background-color: #27ae60;
      width: auto;
      margin-top: 10px;
    }
    .add-player-btn:hover {
      background-color: #229954;
    }
    .remove-player-btn {
      background-color: #e74c3c;
      width: auto;
      margin-top: 10px;
    }
    .remove-player-btn:hover {
      background-color: #c0392b;
    }
    .player-count {
      font-weight: bold;
      color: #3498db;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ ì •í™•í•œ í¬ì»¤ ìŠ¹ë¥  ê³„ì‚°ê¸°</h1>
    <p style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">
      í”„ë¦¬í”Œë, í”Œë, í„´, ë¦¬ë²„ ëª¨ë“  ìƒí™©ì—ì„œ ì •í™•í•œ í™•ë¥  ê³„ì‚°! (2ëª…~6ëª… í”Œë ˆì´ì–´ ì§€ì›)
    </p>

    <div class="input-group">
      <label>ë‚´ ì¹´ë“œ 2ì¥ (ì˜ˆ: AS AD ë˜ëŠ” 10S QH):</label>
      <input id="my-hand" type="text" placeholder="ì˜ˆ: AS AD">
    </div>

    <div class="player-inputs">
      <div class="player-count">ğŸ‘¥ ìƒëŒ€ í”Œë ˆì´ì–´ë“¤</div>
      
      <div class="input-group">
        <label>ìƒëŒ€ 1 ì¹´ë“œ 2ì¥ (ì˜ˆ: KS KD ë˜ëŠ” 10C 10D):</label>
        <input id="opp-1" type="text" placeholder="ì˜ˆ: KS KD">
      </div>

      <div class="input-group" id="opp-2-group" style="display: none;">
        <label>ìƒëŒ€ 2 ì¹´ë“œ 2ì¥ (ì˜ˆ: QS QD):</label>
        <input id="opp-2" type="text" placeholder="ì˜ˆ: QS QD">
      </div>

      <div class="input-group" id="opp-3-group" style="display: none;">
        <label>ìƒëŒ€ 3 ì¹´ë“œ 2ì¥ (ì˜ˆ: JS JD):</label>
        <input id="opp-3" type="text" placeholder="ì˜ˆ: JS JD">
      </div>

      <div class="input-group" id="opp-4-group" style="display: none;">
        <label>ìƒëŒ€ 4 ì¹´ë“œ 2ì¥ (ì˜ˆ: 10S 10D):</label>
        <input id="opp-4" type="text" placeholder="ì˜ˆ: 10S 10D">
      </div>

      <button class="add-player-btn" onclick="addPlayer()">+ ìƒëŒ€ ì¶”ê°€</button>
      <button class="remove-player-btn" onclick="removePlayer()" style="display: none;">- ìƒëŒ€ ì œê±°</button>
    </div>

    <div class="input-group">
      <label>ë³´ë“œ ì¹´ë“œ (0~5ì¥, ì˜ˆ: 3C 7D QH ë˜ëŠ” 10S 5C):</label>
      <input id="comm-cards" type="text" placeholder="ì˜ˆ: 3C 7D QH">
    </div>

    <button onclick="calculate()">ìŠ¹ë¥  ê³„ì‚°í•˜ê¸°</button>

    <div class="result">
      <h3>ğŸ“Š ê³„ì‚° ê²°ê³¼</h3>
      <div id="result">ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>

    <div class="info">
      <h4>ğŸ’¡ ì‚¬ìš©ë²•</h4>
      <ul>
        <li><strong>ì¹´ë“œ í˜•ì‹:</strong> AS (ì—ì´ìŠ¤ ìŠ¤í˜ì´ë“œ), 10S (10 ìŠ¤í˜ì´ë“œ), KD (í‚¹ ë‹¤ì´ì•„ëª¬ë“œ)</li>
        <li><strong>í”Œë ˆì´ì–´:</strong> 2ëª…~6ëª…ê¹Œì§€ ì§€ì› (ë‚´ê°€ ì´ê¸°ë ¤ë©´ ëª¨ë“  ìƒëŒ€ë¥¼ ì´ê²¨ì•¼ í•¨)</li>
        <li><strong>ë³´ë“œ ì¹´ë“œ:</strong> 0ì¥=í”„ë¦¬í”Œë, 3ì¥=í”Œë, 4ì¥=í„´, 5ì¥=ë¦¬ë²„</li>
        <li><strong>ì •í™•ë„:</strong> ë¦¬ë²„/í„´/í”Œë=100% ì •í™•, í”„ë¦¬í”Œë=ê³ ì •ë°€ ì‹œë®¬ë ˆì´ì…˜</li>
      </ul>
    </div>
  </div>

  <script>
    let playerCount = 1; // í˜„ì¬ ìƒëŒ€ í”Œë ˆì´ì–´ ìˆ˜

    function addPlayer() {
      if (playerCount < 5) { // ìµœëŒ€ 6ëª… (ë‚´ê°€ 1ëª… + ìƒëŒ€ 5ëª…)
        playerCount++;
        document.getElementById(`opp-${playerCount}-group`).style.display = 'block';
        document.querySelector('.remove-player-btn').style.display = 'inline-block';
        
        if (playerCount === 5) {
          document.querySelector('.add-player-btn').style.display = 'none';
        }
      }
    }

    function removePlayer() {
      if (playerCount > 1) {
        document.getElementById(`opp-${playerCount}`).value = '';
        document.getElementById(`opp-${playerCount}-group`).style.display = 'none';
        playerCount--;
        
        document.querySelector('.add-player-btn').style.display = 'inline-block';
        
        if (playerCount === 1) {
          document.querySelector('.remove-player-btn').style.display = 'none';
        }
      }
    }

    // ì¹´ë“œ í˜•ì‹ ê²€ì¦
    function isValidCard(card) {
      const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];
      const suits = ['S', 'H', 'D', 'C'];
      
      if (card.length === 2) {
        return ranks.includes(card[0].toUpperCase()) && suits.includes(card[1].toUpperCase());
      } else if (card.length === 3 && card.toUpperCase().startsWith('10')) {
        return suits.includes(card[2].toUpperCase());
      }
      return false;
    }

    // ì¤‘ë³µ ì¹´ë“œ ê²€ì¦
    function hasDuplicateCards(allCards) {
      const cardSet = new Set();
      for (const card of allCards) {
        if (cardSet.has(card)) {
          return true;
        }
        cardSet.add(card);
      }
      return false;
    }

    function calculate() {
      const my = document.getElementById("my-hand").value.trim();
      
      // ìƒëŒ€ í”Œë ˆì´ì–´ë“¤ì˜ ì¹´ë“œ ìˆ˜ì§‘
      const opponents = [];
      for (let i = 1; i <= playerCount; i++) {
        const opp = document.getElementById(`opp-${i}`).value.trim();
        if (opp) {
          opponents.push(opp);
        }
      }

      const comm = document.getElementById("comm-cards").value.trim();

      // ì…ë ¥ ê²€ì¦
      if (!my) {
        document.getElementById("result").innerHTML = '<span class="error">ë‚´ ì¹´ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }

      if (opponents.length === 0) {
        document.getElementById("result").innerHTML = '<span class="error">ìµœì†Œ 1ëª…ì˜ ìƒëŒ€ê°€ í•„ìš”í•©ë‹ˆë‹¤.</span>';
        return;
      }

      // ì¹´ë“œ ê°œìˆ˜ ë° í˜•ì‹ ê²€ì¦
      const myCards = my.split(/\s+/);
      if (myCards.length !== 2) {
        document.getElementById("result").innerHTML = '<span class="error">ë‚´ ì¹´ë“œëŠ” ì •í™•íˆ 2ì¥ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
        return;
      }

      // ë‚´ ì¹´ë“œ í˜•ì‹ ê²€ì¦
      for (const card of myCards) {
        if (!isValidCard(card)) {
          document.getElementById("result").innerHTML = '<span class="error">ë‚´ ì¹´ë“œ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜ˆ: AS, 10S</span>';
          return;
        }
      }

      // ìƒëŒ€ ì¹´ë“œ ê²€ì¦
      for (let i = 0; i < opponents.length; i++) {
        const oppCards = opponents[i].split(/\s+/);
        if (oppCards.length !== 2) {
          document.getElementById("result").innerHTML = `<span class="error">ìƒëŒ€ ${i + 1} ì¹´ë“œëŠ” ì •í™•íˆ 2ì¥ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>`;
          return;
        }
        
        for (const card of oppCards) {
          if (!isValidCard(card)) {
            document.getElementById("result").innerHTML = `<span class="error">ìƒëŒ€ ${i + 1} ì¹´ë“œ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜ˆ: AS, 10S</span>`;
            return;
          }
        }
      }

      const commCards = comm ? comm.split(/\s+/) : [];
      if (commCards.length > 5) {
        document.getElementById("result").innerHTML = '<span class="error">ë³´ë“œ ì¹´ë“œëŠ” ìµœëŒ€ 5ì¥ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>';
        return;
      }

      // ë³´ë“œ ì¹´ë“œ í˜•ì‹ ê²€ì¦
      for (const card of commCards) {
        if (!isValidCard(card)) {
          document.getElementById("result").innerHTML = '<span class="error">ë³´ë“œ ì¹´ë“œ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜ˆ: AS, 10S</span>';
          return;
        }
      }

      // ì¤‘ë³µ ì¹´ë“œ ê²€ì¦
      const allCards = [...myCards, ...commCards];
      for (const opponent of opponents) {
        allCards.push(...opponent.split(/\s+/));
      }

      if (hasDuplicateCards(allCards)) {
        document.getElementById("result").innerHTML = '<span class="error">ì¤‘ë³µëœ ì¹´ë“œê°€ ìˆìŠµë‹ˆë‹¤. ê°™ì€ ì¹´ë“œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>';
        return;
      }

      // ìƒí™© íŒë‹¨
      let situation = "";
      let calculationType = "";
      
      if (commCards.length === 0) {
        situation = "í”„ë¦¬í”Œë";
        calculationType = "ê³ ì •ë°€ ì‹œë®¬ë ˆì´ì…˜ (50,000ë²ˆ)";
      } else if (commCards.length === 1) {
        situation = `ë³´ë“œ ì¹´ë“œ 1ì¥`;
        calculationType = "ì •í™•í•œ ê³„ì‚°";
      } else if (commCards.length === 2) {
        situation = `ë³´ë“œ ì¹´ë“œ 2ì¥`;
        calculationType = "ì •í™•í•œ ê³„ì‚°";
      } else if (commCards.length === 3) {
        situation = "í”Œë";
        calculationType = "ì •í™•í•œ ê³„ì‚°";
      } else if (commCards.length === 4) {
        situation = "í„´";
        calculationType = "ì •í™•í•œ ê³„ì‚°";
      } else if (commCards.length === 5) {
        situation = "ë¦¬ë²„";
        calculationType = "ì •í™•í•œ ê³„ì‚°";
      }

      // ë¡œë”© í‘œì‹œ
      document.getElementById("result").innerHTML = '<span class="success">ğŸ”„ ì •í™•í•œ ê³„ì‚° ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</span>';

      // ë°±ì—”ë“œ API í˜¸ì¶œ
      fetch('http://localhost:5000/calculate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          my_hand: my,
          opponents: opponents,
          community: comm
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.error) {
          document.getElementById("result").innerHTML = `<span class="error">ì˜¤ë¥˜: ${data.error}</span>`;
          return;
        }

        // ê²°ê³¼ í‘œì‹œ
        let opponentsHTML = "";
        for (let i = 0; i < opponents.length; i++) {
          opponentsHTML += `ìƒëŒ€ ${i + 1} í•¸ë“œ: ${opponents[i].split(/\s+/).join(' ')}<br>`;
        }

        const resultHTML = `
          <div class="success">
            <strong>ğŸ¯ ${data.total_players}ëª… í”Œë ˆì´ì–´ - ${situation} ìƒí™© (${calculationType})</strong><br><br>
            <strong>ì…ë ¥ í™•ì¸:</strong><br>
            ë‚´ í•¸ë“œ: ${myCards.join(' ')}<br>
            ${opponentsHTML}
            ${commCards.length > 0 ? `ë³´ë“œ: ${commCards.join(' ')}<br>` : ''}<br>
            <strong>ê²°ê³¼:</strong><br>
            ìŠ¹ë¥ : ${data.win.toFixed(2)}%<br>
            ë¬´ìŠ¹ë¶€: ${data.tie.toFixed(2)}%<br>
            íŒ¨ë°°: ${data.loss.toFixed(2)}%
          </div>
        `;

        document.getElementById("result").innerHTML = resultHTML;
      })
      .catch(error => {
        document.getElementById("result").innerHTML = `
          <span class="error">
            ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${error.message}<br>
            Python ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.<br>
            í„°ë¯¸ë„ì—ì„œ 'python web_server.py' ëª…ë ¹ì–´ë¡œ ì„œë²„ë¥¼ ì‹œì‘í•˜ì„¸ìš”.
          </span>
        `;
      });
    }

    // ì—”í„°í‚¤ë¡œ ê³„ì‚° ì‹¤í–‰
    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        calculate();
      }
    });
  </script>
</body>
</html> 